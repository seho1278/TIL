# 커널과 쉘

## 1. 커널
- 운영체제의 핵심
- OS는 더 정확히는 커널을 의미하며 일반적으로 커널에 여러가지가 추가된 상태를 OS라고 통칭함

<br>

## 2. 쉘
- 사용자가 운영체제 기능과 서비스를 조작할 수 있도록 인터페이스를 제공하는 프로그램
- 터미널 환경(CLI)과 GUI 환경 두 종류로 분류
- 쉘도 애플리케이션과 같이 하나의 응용 프로그램으로 분류
- ex) 리눅스 bash (쉘 프로그램)

### 동작 원리
- 사용자에게 쉘 프로그램(CLI or GUI) 제공을 통해 입력을 받아 커널을 동작할 수 있게끔 함
![OS 사진](OS.png)

<br>

## 3. 시스템 콜
- 시스템 콜 또는 시스템 호출 인터페이스
- 커널과 쉘의 커뮤니케이션을 돕는다.
- 운영체제가 운영체제 각 기능을 사용할 수 있도록 시스템 콜이라는 명령 또는 함수를 제공
- Linux의 경우 C, C++ 언어로 보통구현이 되어있음 (함수형태)

### 프로그래밍 언어별 해당 운영체제에 맞는 API 구현
- API(Application Programming Interface)
  - 모호한 용어이지만, 간단히 함수 또는 라이브러리라고 이해
- API 내부에는 필요시 해당 운영체제의 시스템 콜을 호출하는 형태로 만들어짐
  - 파일처리, 네트워크처리, JavaIO 등 라이브러리나 패키지 형태로 제공
#### 예시
- Java의 경우 JDK를 설치
  - 내부에서 자바로 작성된 파일처리하는 함수 호출 -> jdk가 해당 os에서 제공하고 있는 파일을 오픈하는 시스템 콜을 호출
- 웹 브라우저에서 해당 커널에 파일을 처리하는 시스템 콜을 호출하고 결과를 웹 브라우저에 전달

<br>

## 4. 운영체제 정리
![운영체제 정리](OS2.png)
- 운영체제를 만든다면?
  - 운영체제를 개발(kernel)
  - 커널기능을 사용자가 사용할 수 있게 시스템콜 개발
  - 시스템콜 기반, 프로그래밍 언어별 라이브러리 개발(API)
    - 해당 커널에 지원할 수 있게 porting
  - 지원되는 프로그래밍 언어로 Shell 프로그램 개발
  - 지원되는 프로그래밍 언어로 응용 프로그램 개발(Application)

<br>

## 5. 사용자 모드 & 커널 모드
- 함부로 응용 프로그램이 전체 컴퓨터 시스템을 헤치지 못함
- 주민등록등본은 꼭 동사무소 또는 민원24시에서 특별한 신청서를 써야만 발급
  - 동사무소 직원분들은 특별한 권한을 가지고, 주민등록등본 출력 명령을 실행
- 컴퓨터에 큰 영향을 미칠 기능들은 운영체제만 할 수 있도록 함

### 사용자모드
- 응용프로그램 동작
- 중요한 동작이 있는 경우 반드시 커널에 시스템 콜을 통해 요청 커널 모드로 바꾼 뒤 요청을 처리하고 결과를 응용 프로그램으로 전달

### 사용자모드와 커널 모드 구현
- CPU Protection Ring (CPU 자체 제공)
  - 사용자 모드 (user mode) : 응용 프로그램이 사용
  - 커널 모드 (kernel mode) : OS가 사용

- CPU에 무언가가 실행할 때마다 Protection Ring에 적혀 있는 level(권한 레벨) 정보를 같이 입력
  - 커널 : level 0
  - OS 서비스 : level 1, 2
  - 응용 프로그램 : level 3
- 중요한 명령의 경우 level값을 확인 후 명령 처리에 적합할 경우 실행

### 시스템 콜은 커널 모드로 실행
- 커널 모드에서만 실행 가능한 기능들
- 커널 모드로 실행하려면, 반드시 시스템 콜을 사용해야 함
- 시스템 콜은 운영체제에서 제공

#### 만약 App Store에서 다운받은 앱이 휴대폰 데이터를 삭제하는 코드가 들어 있다면?
- 앱이 동작하기 위해 필요한 권한을 사용자에게 입력받는 경우
- 앱마다 어떤 권한을 허용했는지에 대한 정보를 커널이 가지고 있다 해당 앱이 요청을하면 정보에 맞춰 허용된 기능만 커널이 실행

<br>

## 6. 정리
- 운영체제는 시스템 콜 제공
- 프로그래밍 언어별 운영체제 지원을 위해, 운영체제 별 API 제공
- 응용 프로그램 개발시 운영체제 기능이 필요한 경우, 해당 API를 사용해서 프로그램 작성
- 응용 프로그램 실행시, 해당 API를 호출하면, 시스템 콜 호출, 커널 모드로 변경 후, OS 내부에서 해당 명령이 실행되고, 응용 프로그램에 결과 리턴


<br>

<br>

<br>

### [위로](#) / [뒤로](/README.md)